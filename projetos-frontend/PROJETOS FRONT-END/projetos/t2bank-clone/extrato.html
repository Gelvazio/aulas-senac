<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        
        
        <meta name="description" content="">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>T2Bank</title>

        <script src="./T2Bank_files/tabler.min.js"></script>
        <link rel="stylesheet" href="./T2Bank_files/tabler.min.css">

        <script src="./T2Bank_files/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
        <script src="./T2Bank_files/jquery.maskedinput.min.js"></script>
    </head>    
<body class="antialiased">
    <div class="wrapper">
        <aside class="navbar navbar-vertical navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <h1 class="navbar-brand navbar-brand-autodark">
                    <a href="#home">
                        <img src="./T2Bank_files/t2bank.png" width="80" height="18">
                    </a>
                </h1>
                <div class="navbar-nav flex-row d-lg-none">
                </div>
                <div class="collapse navbar-collapse" id="navbar-menu">
                    <ul class="navbar-nav pt-lg-3">
                        <li class="nav-item">
                            <a class="nav-link" href="#home">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><polyline points="5 12 3 12 12 3 21 12 19 12"></polyline><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"></path><path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"></path></svg>
                                </span>
                                <span class="nav-link-title">
                                    Principal
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#extrato">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                	<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"></path><rect x="9" y="3" width="6" height="4" rx="2"></rect><path d="M14 11h-2.5a1.5 1.5 0 0 0 0 3h1a1.5 1.5 0 0 1 0 3h-2.5"></path><path d="M12 17v1m0 -8v1"></path></svg>
                                </span>
                                <span class="nav-link-title">
                                    Extrato
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#transferencia">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
	                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M4 21v-4a3 3 0 0 1 3 -3h5"></path><path d="M9 17l3 -3l-3 -3"></path><path d="M14 3v4a1 1 0 0 0 1 1h4"></path><path d="M5 11v-6a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-9.5"></path></svg>
                                </span>
                                <span class="nav-link-title">
                                    Transferência
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-red" href="#logout">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">                                                                        
                                	<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2"></path><path d="M7 12h14l-3 -3m0 6l3 -3"></path></svg>
                                </span>
                                <span class="nav-link-title">
                                    Sair
                                </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </aside>

        <div class="page-wrapper">
            <div class="container-xl">
                <div class="page-body">
                    <div class="row row-cards">
                        <div class="col">
                            <!-- Page pre-title -->
                            <h4 class="page-title">
                                Principal 
                            </h4>
                        </div>
                
                        <div class="col-12 mt-3">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Principal titulo</h3>
                                </div>

                                <div class="card-header" style="width: 350px;">
                                    <div>
                                        <label class="form-label" style="width: 100%;" for="intervalo">Intervalo</label>
                                        <select class="form-select" id="intervalo">
                                            <option value="5">Últimos 5 dias</option>
                                            <option value="15">Últimos 15 dias</option>
                                            <option value="30">Últimos 30 dias</option>
                                            <option value="60">Últimos 60 dias</option>
                                            <option value="90">Últimos 90 dias</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="card-footer align-items-right">
                                    <p class="m-0 text-muted">Valor total R$ 110671,98 </p>                                    
                                    <button type="button" onclick="exportaCSV()">Exportar CSV</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {         
            $("#intervalo").on("change", function() {
                const intervalo = $(this).val();
                carregaExtrato(intervalo);
            });

            if (parseInt(localStorage.getItem('intervalo')) > 0) {
                $("#intervalo").val(localStorage.getItem('intervalo'));
            }

            localStorage.removeItem('intervalo');
        });

        function exportaCSV(extrato) {
            let rows = []

            for (let item of extrato) {                
                const valor = item.valor.toString()
                const row = [ valor.replace(".", ","), item.data_hora_baixa, item.descricao, item.cpf, item.nome, item.data_hora_pago ]                
                rows.push(row)
            }
            
            let conteudo = "Valor;Data/Hora Baixa;Descricao;CPF;Nome;Data/Hora Pagamento\n\n"

            rows.forEach(function(row) {
                conteudo += row.join(";")
                conteudo += "\n"
            });

            const todayDate = new Date().toISOString().slice(0, 10);

            let link = document.createElement("a")
            link.href = 'data:text/csv;charset=utf-8,' + encodeURI(conteudo)
            
            link.target = "_blank"
            link.download = "extrato-"+todayDate+".csv"
            link.click()
        }

        function carregaExtrato(intervalo) {
            localStorage.setItem('intervalo', intervalo);

            console.log("carrega ext");
            console.log(intervalo);

            window.location.href = "/extrato_data/"+intervalo.toString();
        }
    </script>



</body></html>